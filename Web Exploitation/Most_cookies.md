## Most Cookies
Author: madStacks

Category: Web Exploitation

Difficulty: Medium

## Description
Alright, enough of using my own encryption. Flask session cookies should be plenty secure! server.py http://mercury.picoctf.net:52134/

## Solve 
**Flag:** `picoCTF{pwn_4ll_th3_cook1E5_478da04c}`

- In this challenge, we are given a flask application file: server.py. In that file, there is a list of cookies and out of them, a random cookie is selected to make the session secret key.
  
   <img width="722" height="400" alt="Screenshot 2025-10-17 110130" src="https://github.com/user-attachments/assets/ac2396bc-8ba4-4dab-a95a-805aecccd542" />
   
- As the challenge name suggests, we need to find the correct cookie value to gain access to the flag. I initially just typed the `snickerdoodle` value that is already shown on the content box. But as expected, it was the incorrect value.
- So after searching around, I found a site that contained all the necessary commands to deal with these cookies.
- Using that, I found that these cookies are base64 encoded. So I decoded the cookie and found: 

   <img width="936" height="75" alt="Screenshot 2025-10-17 110547" src="https://github.com/user-attachments/assets/405e8370-fabf-4405-83b5-4744d5c88603" />

- Now the next task was to find the secret key being used in the cookie as that will allow me to modify it to set the value `{'very_auth': 'admin'}`. So I did this: 

   <img width="938" height="168" alt="Screenshot 2025-10-17 110804" src="https://github.com/user-attachments/assets/295552b1-6b25-4ce3-930a-2e2d1fc7f0f1" />

- Now, once I got the secret key, I made my own signed cookie with the value set to admin:
 
   <img width="934" height="77" alt="Screenshot 2025-10-17 110858" src="https://github.com/user-attachments/assets/c77189af-572a-48c7-91f5-9cb310a06d6f" />

- I then copied this cookie to the website and replaced the original cookie with it. On reloading the site, I found the flag.

## References
1. [Flask: Hacktricks](https://angelica.gitbook.io/hacktricks/network-services-pentesting/pentesting-web/flask)
2. [Decoding, Brute-Forcing and Crafting Flask Session Cookies - "web-intro" [DefCamp CTF 2022]](https://www.youtube.com/watch?v=dA28abgc57o)
